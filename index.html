<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>é¢ç§¯ã€å‘¨é•¿ä¸ä½“ç§¯</title>
  <style>
    :root{
      --bg1:#fff7fb;
      --bg2:#f3fbff;
      --card:#ffffff;
      --ink:#24324a;
      --muted:#63728a;
      --accent:#6b8cff;
      --accent2:#ff7fb0;
      --good:#25b36a;
      --warn:#ff9f43;
      --bad:#ff5a6e;
      --shadow: 0 10px 30px rgba(25, 35, 55, .12);
      --r: 18px;
      --btnR: 16px;
      --font: ui-rounded, system-ui, -apple-system, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: var(--font);
      color:var(--ink);
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(107,140,255,.18), transparent 55%),
        radial-gradient(1000px 600px at 80% 0%, rgba(255,127,176,.16), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }

    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:14px}
    .brand{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:999px;background:rgba(255,255,255,.65);box-shadow:0 6px 18px rgba(25,35,55,.08);backdrop-filter:blur(8px)}
    .logo{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:grid;place-items:center;box-shadow:0 10px 18px rgba(107,140,255,.25)}
    .logo svg{width:22px;height:22px}
    .brand h1{font-size:18px;margin:0;line-height:1.1}

    .pillrow{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{background:rgba(255,255,255,.65);border-radius:999px;padding:10px 12px;box-shadow:0 6px 18px rgba(25,35,55,.08);display:flex;align-items:center;gap:10px;min-height:44px}
    .pill .k{color:var(--muted);font-weight:700}
    .stars{font-size:18px;letter-spacing:1px}

    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:14px}
    @media (max-width:860px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card);border-radius:var(--r);box-shadow:var(--shadow);padding:14px}
    .card.soft{background:rgba(255,255,255,.75);backdrop-filter:blur(8px)}
    .title{margin:4px 0 10px;font-size:22px;letter-spacing:.5px}
    .subtitle{margin:0 0 10px;color:var(--muted);font-weight:700;font-size:14px}
    .bigTitle{font-size:34px;margin:10px 0 8px;text-align:center}
    .center{display:flex;flex-direction:column;align-items:center;gap:10px}
    .btnrow{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}

    button{border:none;cursor:pointer;font-family:var(--font);font-weight:900;border-radius:var(--btnR);padding:14px 16px;font-size:18px;min-width:140px;box-shadow:0 10px 22px rgba(25,35,55,.12);transition:transform .08s ease,filter .08s ease;user-select:none;-webkit-tap-highlight-color:transparent}
    button:active{transform:translateY(1px) scale(.99);filter:saturate(.95)}
    button:disabled{opacity:.55;cursor:not-allowed}
    .primary{background:linear-gradient(135deg,var(--accent),#7bd3ff);color:#fff}
    .secondary{background:linear-gradient(135deg,#ff93c3,var(--accent2));color:#fff}
    .ghost{background:rgba(99,114,138,.10);color:var(--ink)}
    .smallBtn{min-width:unset;padding:10px 12px;font-size:16px;border-radius:14px;box-shadow:0 8px 16px rgba(25,35,55,.10)}

    .stage{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-bottom:10px}
    .stage .chip{background:rgba(107,140,255,.10);border-radius:999px;padding:8px 12px;font-weight:900}
    .progress{flex:1;min-width:220px;height:12px;background:rgba(99,114,138,.14);border-radius:999px;overflow:hidden}
    .progress>div{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:999px;transition:width .25s ease}

    .prompt{display:flex;flex-direction:column;gap:10px}
    .qtext{font-size:18px;font-weight:900;margin:0;line-height:1.35}
    .hint{color:var(--muted);font-weight:800;margin:0;font-size:14px}

    .canvasWrap{border-radius:16px;background:linear-gradient(180deg,rgba(107,140,255,.08),rgba(255,127,176,.06));padding:12px;display:flex;justify-content:center;align-items:center;min-height:260px}
    svg{max-width:100%;height:auto}

    .answerRow{display:flex;gap:10px;flex-wrap:wrap;align-items:stretch;margin-top:6px}
    .inputWrap{flex:1;min-width:220px;display:flex;border-radius:16px;overflow:hidden;background:rgba(255,255,255,.92);box-shadow:inset 0 0 0 2px rgba(99,114,138,.14)}
    input{border:none;outline:none;padding:14px 14px;font-size:20px;font-weight:900;width:100%;background:transparent}
    .unit{display:grid;place-items:center;padding:0 12px;background:rgba(99,114,138,.08);color:var(--muted);font-weight:900;min-width:64px}

    .msg{margin-top:10px;padding:12px;border-radius:16px;background:rgba(255,255,255,.75);box-shadow:0 10px 22px rgba(25,35,55,.10);display:none;gap:10px;align-items:flex-start}
    .msg.show{display:flex}
    .msg .icon{width:34px;height:34px;border-radius:14px;display:grid;place-items:center;flex:0 0 auto}
    .msg.good .icon{background:rgba(37,179,106,.14);color:var(--good)}
    .msg.bad .icon{background:rgba(255,90,110,.14);color:var(--bad)}
    .msg.warn .icon{background:rgba(255,159,67,.14);color:var(--warn)}
    .msg p{margin:0}
    .msg .big{font-weight:1000;font-size:18px;margin-bottom:4px}
    .msg .eq{font-family:ui-monospace, Menlo, Consolas, monospace;font-weight:900;font-size:14px;color:var(--ink)}

    .rightCard .stat{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border-radius:16px;background:rgba(99,114,138,.08);margin-bottom:10px}
    .rightCard .stat b{font-size:18px}
    .rightCard .stat span{color:var(--muted);font-weight:900}

    .levelList{display:grid;gap:10px}
    .levelBtn{width:100%;text-align:left;display:flex;align-items:center;justify-content:space-between;gap:10px;padding:14px;border-radius:18px;background:rgba(255,255,255,.8);box-shadow:0 10px 22px rgba(25,35,55,.10);border:2px solid rgba(99,114,138,.12)}
    .levelBtn.locked{opacity:.55;filter:grayscale(.12)}
    .levelBtn .left{display:flex;align-items:center;gap:10px}
    .levelBtn .num{width:44px;height:44px;border-radius:16px;display:grid;place-items:center;background:linear-gradient(135deg,rgba(107,140,255,.20),rgba(255,127,176,.18));font-size:18px;font-weight:1000}
    .levelBtn .name{font-weight:1000;font-size:16px}
    .levelBtn .desc{color:var(--muted);font-weight:800;font-size:13px}

    .toast{position:fixed;left:50%;top:14px;transform:translateX(-50%);background:rgba(255,255,255,.85);backdrop-filter:blur(10px);border-radius:999px;padding:10px 14px;box-shadow:0 10px 28px rgba(25,35,55,.14);display:none;font-weight:1000;z-index:99}
    .toast.show{display:block;animation:pop .18s ease}
    @keyframes pop{from{transform:translateX(-50%) scale(.96);opacity:.4}to{transform:translateX(-50%) scale(1);opacity:1}}

    .sparkle{position:absolute;pointer-events:none;width:10px;height:10px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff,rgba(255,255,255,.2));box-shadow:0 0 0 2px rgba(255,255,255,.35),0 10px 20px rgba(107,140,255,.25);animation:fly .65s ease forwards}
    @keyframes fly{from{transform:translate(0,0) scale(.9);opacity:1}to{transform:translate(var(--dx),var(--dy)) scale(.2);opacity:0}}
  </style>
</head>
<body>
  <div class="toast" id="toast">æç¤º</div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand" aria-label="æ¸¸æˆæ ‡é¢˜">
        <div class="logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M6 7.5h12M6 12h12M6 16.5h12" stroke="white" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h1>é¢ç§¯ã€å‘¨é•¿ä¸ä½“ç§¯</h1>
        </div>
      </div>

      <div class="pillrow">
        <div class="pill" title="æœ¬å±€ç´¯è®¡æ˜Ÿæ˜Ÿ">
          <span class="k">æ˜Ÿæ˜Ÿ</span>
          <span class="stars" id="stars">â­ 0</span>
        </div>
        <div class="pill" title="å†å²æœ€é«˜æ˜Ÿæ˜Ÿï¼ˆæœ¬æœºä¿å­˜ï¼‰">
          <span class="k">æœ€é«˜</span>
          <b id="best">â­ 0</b>
        </div>
      </div>
    </div>

    <div class="card soft" id="home">
      <div class="center">
        <div class="bigTitle">é¢ç§¯ã€å‘¨é•¿ä¸ä½“ç§¯</div>
        <p class="subtitle" style="text-align:center; max-width:720px">
          é€šè¿‡å¯è§†åŒ–å›¾å½¢é—¯å…³ï¼Œå­¦ä¼šï¼šå‘¨é•¿ã€é¢ç§¯ã€ä½“ç§¯å…¬å¼ã€‚æ¯é¢˜è¾“å…¥æ•°å­—å³å¯ï¼Œå•ä½ä¼šè‡ªåŠ¨æ˜¾ç¤ºã€‚
        </p>
      </div>

      <hr style="border:none; border-top:2px dashed rgba(99,114,138,.18); margin: 16px 0">

      <h2 class="title" style="margin-top:0">é€‰æ‹©å…³å¡</h2>
      <p class="subtitle">å…ˆä»ç¬¬ 1 å…³å¼€å§‹ï¼Œç­”å¯¹è¶Šå¤šæ˜Ÿæ˜Ÿè¶Šå¤šã€‚é€šå…³ä¼šè§£é”ä¸‹ä¸€å…³ï¼</p>

      <div class="levelList" id="levelList"></div>
    </div>

    <div class="grid" id="game" style="display:none">
      <div class="card">
        <div class="stage">
          <div class="chip" id="stageChip">ç¬¬ 1 å…³</div>
          <div class="progress" aria-label="è¿›åº¦"><div id="prog"></div></div>
          <div class="chip" id="qCount">1 / 8</div>
        </div>

        <div class="prompt">
          <p class="qtext" id="qText">é¢˜ç›®</p>
          <p class="hint" id="qHint">çœ‹å›¾æ‰¾å·²çŸ¥é‡ï¼Œç„¶åé€‰æ‹©åˆé€‚çš„å…¬å¼ã€‚</p>
        </div>

        <div class="canvasWrap" id="viz" aria-label="å¯è§†åŒ–å›¾å½¢"></div>

        <div class="answerRow">
          <div class="inputWrap" aria-label="è¾“å…¥ç­”æ¡ˆ">
            <input id="ans" inputmode="numeric" pattern="[0-9]*" autocomplete="off" placeholder="è¾“å…¥æ•°å­—" />
            <div class="unit" id="unit">cmÂ²</div>
          </div>
          <button class="primary" id="btnSubmit">æäº¤</button>
          <button class="ghost" id="btnSkip">è·³è¿‡</button>
        </div>

        <div class="msg" id="msg" role="status" aria-live="polite">
          <div class="icon" aria-hidden="true">
            <svg id="msgSvg" viewBox="0 0 24 24" width="20" height="20" fill="none"></svg>
          </div>
          <div>
            <p class="big" id="msgTitle">åšå¾—å¥½ï¼</p>
            <p id="msgBody">å†…å®¹</p>
            <p class="eq" id="msgEq"></p>
            <div class="btnrow" style="justify-content:flex-start; margin-top:10px">
              <button class="smallBtn secondary" id="btnNext">ä¸‹ä¸€é¢˜</button>
            </div>
          </div>
        </div>
      </div>

      <div class="card rightCard">
        <h2 class="title" style="margin-top:0">æœ¬å…³ä¿¡æ¯</h2>
        <div class="stat">
          <span>æœ¬å…³æ˜Ÿæ˜Ÿ</span>
          <b id="levelStars">â­ 0</b>
        </div>
        <div class="stat">
          <span>è·³è¿‡æ‰£åˆ†</span>
          <b>â­ -1</b>
        </div>

        <div class="card soft" style="padding:12px">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px">
            <b>å…¬å¼å°æŠ„</b>
            <button class="smallBtn ghost" id="btnCheat">å±•å¼€/æ”¶èµ·</button>
          </div>
          <div id="cheat" style="display:none; margin-top:10px; font-weight:900; color:var(--muted); line-height:1.55">
            <div>æ­£å¤šè¾¹å½¢å‘¨é•¿ï¼šå‘¨é•¿ = è¾¹æ•° Ã— è¾¹é•¿</div>
            <div>é•¿æ–¹å½¢é¢ç§¯ï¼šé¢ç§¯ = é•¿ Ã— å®½</div>
            <div>æ­£æ–¹å½¢é¢ç§¯ï¼šé¢ç§¯ = è¾¹é•¿ Ã— è¾¹é•¿</div>
            <div>ä¸‰è§’å½¢é¢ç§¯ï¼šé¢ç§¯ = (åº• Ã— é«˜) Ã· 2</div>
            <div>é•¿æ–¹ä½“ä½“ç§¯ï¼šä½“ç§¯ = é•¿ Ã— å®½ Ã— é«˜</div>
            <div>æ­£æ–¹ä½“ä½“ç§¯ï¼šä½“ç§¯ = è¾¹é•¿Â³</div>
          </div>
        </div>

        <div class="btnrow" style="justify-content:stretch">
          <button class="ghost" id="btnBack">è¿”å›é¦–é¡µ</button>
        </div>
      </div>
    </div>

    <div class="card" id="end" style="display:none">
      <div class="center">
        <div class="bigTitle">æœ¬å…³å®Œæˆï¼</div>
        <p class="subtitle" id="endText" style="text-align:center"></p>
        <div class="btnrow">
          <button class="primary" id="btnContinue">ç»§ç»­ä¸‹ä¸€å…³</button>
          <button class="secondary" id="btnHome">å›åˆ°é¦–é¡µ</button>
        </div>
      </div>
    </div>
  </div>

  <script>
  /**
   * å•æ–‡ä»¶ç¦»çº¿å°æ¸¸æˆ
   * å·²ç§»é™¤ï¼šæç¤ºæŒ‰é’®/æç¤ºæ¬¡æ•°ã€â€œå†æ¥ä¸€é¢˜â€ã€å¾½ç« ã€é¦–é¡µå¤šä½™æŒ‰é’®ã€‚
   * æœ¬æ¬¡ä¿®å¤ï¼šæ¸…ç†ä¸åŒ¹é…çš„å¤§æ‹¬å·ï¼Œé¿å… "Unexpected token '}'"ã€‚
   */

  // =====================
  // 1) CONFIGï¼ˆå¯æ”¹é¢˜ç›®èŒƒå›´ã€å…³å¡é¢˜æ•°ç­‰ï¼‰
  // =====================
  var CONFIG = {
    minVal: 3,
    maxVal: 20,
    questionsPerLevel: 8,
    levels: [
      { id: 1, name: 'æ­£å¤šè¾¹å½¢å‘¨é•¿', desc: 'å‘¨é•¿ = è¾¹æ•° Ã— è¾¹é•¿ï¼ˆè¾¹æ•°=3~10ï¼‰', types: ['perimeter_regular_polygon'] },
      { id: 2, name: 'å¹³é¢å›¾å½¢é¢ç§¯', desc: 'æ­£æ–¹å½¢/é•¿æ–¹å½¢/ä¸‰è§’å½¢', types: ['area_square','area_rectangle','area_triangle'] },
      { id: 3, name: 'ç«‹ä½“ä½“ç§¯ï¼ˆç»¼åˆï¼‰', desc: 'é•¿æ–¹ä½“/æ­£æ–¹ä½“', types: ['volume_cuboid','volume_cube'] }
    ],
    scoring: {
      correct: 2,
      skipPenalty: 1,
      unlockStarThreshold: 10
    }
  };

  // =====================
  // 2) Storageï¼ˆæœ€é«˜åˆ†ã€å·²è§£é”å…³å¡ï¼‰
  // =====================
  var STORE_KEY = 'apv_game_v2';
  function loadStore(){
    try{
      var raw = localStorage.getItem(STORE_KEY);
      if(!raw) return { bestStars: 0, unlocked: 1 };
      var d = JSON.parse(raw);
      return {
        bestStars: Number(d.bestStars || 0),
        unlocked: Math.max(1, Number(d.unlocked || 1))
      };
    }catch(e){
      return { bestStars: 0, unlocked: 1 };
    }
  }
  function saveStore(){
    localStorage.setItem(STORE_KEY, JSON.stringify(Store));
  }
  var Store = loadStore();

  // =====================
  // 3) Helpers
  // =====================
  function getEl(id){ return document.getElementById(id); }
  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
  function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
  function choice(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  function toast(msg){
    var t = getEl('toast');
    if(!t) return;
    t.textContent = msg;
    t.classList.add('show');
    clearTimeout(toast._tm);
    toast._tm = setTimeout(function(){ t.classList.remove('show'); }, 1200);
  }

  function spawnSparkles(x,y){
    var n = 10;
    for(var i=0;i<n;i++){
      var s = document.createElement('div');
      s.className = 'sparkle';
      var dx = (Math.random()*2-1)*90;
      var dy = (Math.random()*2-1)*60 - 40;
      s.style.left = x+'px';
      s.style.top = y+'px';
      s.style.setProperty('--dx', dx+'px');
      s.style.setProperty('--dy', dy+'px');
      document.body.appendChild(s);
      setTimeout((function(node){ return function(){ if(node && node.remove) node.remove(); }; })(s), 700);
    }
  }

  // =====================
  // 4) Question Generator
  // =====================
  function genQuestion(level){
    var type = choice(level.types);
    var min = CONFIG.minVal;
    var max = CONFIG.maxVal;

    if(type === 'perimeter_regular_polygon'){
      var n = randInt(3,10);
      var s = randInt(min,max);
      var ans = s * n;
      return {
        type: type,
        known: { n: n, s: s },
        askText: 'æ±‚æ­£' + n + 'è¾¹å½¢çš„å‘¨é•¿ã€‚',
        unit: 'cm',
        answer: ans,
        steps: { equation: 'å‘¨é•¿ = è¾¹æ•°Ã—è¾¹é•¿ = ' + n + 'Ã—' + s + ' = ' + ans }
      };
    }

    if(type === 'area_square'){
      var a = randInt(min,max);
      var ans2 = a*a;
      return {
        type: type,
        known: { a: a },
        askText: 'æ±‚æ­£æ–¹å½¢çš„é¢ç§¯ã€‚',
        unit: 'cmÂ²',
        answer: ans2,
        steps: { equation: 'é¢ç§¯ = è¾¹é•¿Ã—è¾¹é•¿ = ' + a + 'Ã—' + a + ' = ' + ans2 }
      };
    }

    if(type === 'area_rectangle'){
      var L = randInt(min,max);
      var W = randInt(min,max);
      var ans3 = L*W;
      var isSquare = (L === W);
      return {
        type: type,
        known: { L: L, W: W },
        askText: isSquare ? 'æ±‚æ­£æ–¹å½¢çš„é¢ç§¯ã€‚' : 'æ±‚é•¿æ–¹å½¢çš„é¢ç§¯ã€‚',
        unit: 'cmÂ²',
        answer: ans3,
        steps: { equation: (isSquare ? ('é¢ç§¯ = è¾¹é•¿Ã—è¾¹é•¿ = ' + L + 'Ã—' + W + ' = ' + ans3) : ('é¢ç§¯ = é•¿Ã—å®½ = ' + L + 'Ã—' + W + ' = ' + ans3)) }
      };
    }

    if(type === 'area_triangle'){
      var b, h;
      for(var k=0;k<80;k++){
        b = randInt(min,max);
        h = randInt(min,max);
        if(((b*h)%2)===0) break;
      }
      var ans4 = (b*h)/2;
      return {
        type: type,
        known: { b: b, h: h },
        askText: 'æ±‚ä¸‰è§’å½¢çš„é¢ç§¯ã€‚',
        unit: 'cmÂ²',
        answer: ans4,
        steps: { equation: 'é¢ç§¯ = (åº•Ã—é«˜)Ã·2 = (' + b + 'Ã—' + h + ')Ã·2 = ' + (b*h) + 'Ã·2 = ' + ans4 }
      };
    }

    if(type === 'volume_cuboid'){
      var L2 = randInt(min,max);
      var W2 = randInt(min,max);
      var H2 = randInt(min,max);
      var ans5 = L2*W2*H2;
      return {
        type: type,
        known: { L: L2, W: W2, H: H2 },
        askText: 'æ±‚é•¿æ–¹ä½“çš„ä½“ç§¯ã€‚',
        unit: 'cmÂ³',
        answer: ans5,
        steps: { equation: 'ä½“ç§¯ = é•¿Ã—å®½Ã—é«˜ = ' + L2 + 'Ã—' + W2 + 'Ã—' + H2 + ' = ' + ans5 }
      };
    }

    if(type === 'volume_cube'){
      var a2 = randInt(min,max);
      var ans6 = a2*a2*a2;
      return {
        type: type,
        known: { a: a2 },
        askText: 'æ±‚æ­£æ–¹ä½“çš„ä½“ç§¯ã€‚',
        unit: 'cmÂ³',
        answer: ans6,
        steps: { equation: 'ä½“ç§¯ = è¾¹é•¿Â³ = ' + a2 + 'Ã—' + a2 + 'Ã—' + a2 + ' = ' + ans6 }
      };
    }

    return genQuestion({types:['area_rectangle']});
  }

  // =====================
  // 5) Renderer (SVG)
  // =====================
  function renderQuestion(q){
    var box = getEl('viz');
    if(!box) return;
    box.innerHTML = '';

    var svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
    svg.setAttribute('viewBox','0 0 480 300');
    svg.setAttribute('role','img');

    var defs = document.createElementNS(svg.namespaceURI,'defs');
    var fontFamily = 'system-ui, -apple-system, Segoe UI, PingFang SC, Microsoft YaHei, sans-serif';
    defs.innerHTML =
      '<filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">' +
      '<feDropShadow dx="0" dy="8" stdDeviation="8" flood-color="#26324a" flood-opacity=".12"/>' +
      '</filter>' +
      '<marker id="arrow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">' +
      '<path d="M 0 0 L 10 5 L 0 10 z" fill="rgba(36,50,74,.65)" />' +
      '</marker>' +
      '<style>' +
      '.shape{fill: rgba(255,255,255,.88); stroke: rgba(36,50,74,.60); stroke-width: 3; filter: url(#shadow)}' +
      '.soft{fill: rgba(107,140,255,.10); stroke: rgba(107,140,255,.45); stroke-width: 3}' +
      '.dash{stroke-dasharray: 6 6}' +
      '.label{font-family: ' + fontFamily + '; font-weight: 900; fill: rgba(36,50,74,.85); font-size: 18px}' +
      '.line{stroke: rgba(36,50,74,.65); stroke-width: 3}' +
      '</style>';
    svg.appendChild(defs);

    // å¯çˆ±èƒŒæ™¯ç‚¹ç‚¹
    var bg = document.createElementNS(svg.namespaceURI,'g');
    for(var i=0;i<26;i++){
      var c = document.createElementNS(svg.namespaceURI,'circle');
      c.setAttribute('cx', String(randInt(20,460)));
      c.setAttribute('cy', String(randInt(20,280)));
      c.setAttribute('r', String(randInt(2,4)));
      c.setAttribute('fill', (i%2)? 'rgba(107,140,255,.12)' : 'rgba(255,127,176,.10)');
      bg.appendChild(c);
    }
    svg.appendChild(bg);

    if(q.type === 'area_rectangle'){
      drawRectangle(svg, q.known.L, q.known.W, (q.known.L === q.known.W));
    }else if(q.type === 'area_square'){
      drawRectangle(svg, q.known.a, q.known.a, true);
    }else if(q.type === 'area_triangle'){
      drawTriangle(svg, q.known.b, q.known.h);
    }else if(q.type === 'perimeter_regular_polygon'){
      drawRegularPolygon(svg, q.known.n, q.known.s);
    }else if(q.type === 'volume_cuboid'){
      drawCuboid(svg, q.known.L, q.known.W, q.known.H, false);
    }else if(q.type === 'volume_cube'){
      drawCuboid(svg, q.known.a, q.known.a, q.known.a, true);
    }else{
      drawRectangle(svg, 8, 5, false);
    }

    box.appendChild(svg);
  }

  function addText(svg, x, y, text, cls){
    var t = document.createElementNS(svg.namespaceURI,'text');
    t.setAttribute('x', String(x));
    t.setAttribute('y', String(y));
    t.setAttribute('class', cls || 'label');
    t.textContent = text;
    svg.appendChild(t);
    return t;
  }

  function addLine(svg, x1, y1, x2, y2, cls){
    var l = document.createElementNS(svg.namespaceURI,'line');
    l.setAttribute('x1', String(x1));
    l.setAttribute('y1', String(y1));
    l.setAttribute('x2', String(x2));
    l.setAttribute('y2', String(y2));
    l.setAttribute('class', cls || 'line');
    svg.appendChild(l);
    return l;
  }

  function drawRectangle(svg, L, W, isSquare){
    var x = 140, y = 70;
    var base = isSquare ? 150 : 200; // æ­£æ–¹å½¢ç¼©å°ä¸€ç‚¹ï¼Œé¿å…é®æŒ¡ä¸‹æ–¹æ–‡å­—
    var w = base;
    var h = isSquare ? base : 140;

    var rect = document.createElementNS(svg.namespaceURI,'rect');
    rect.setAttribute('x', x);
    rect.setAttribute('y', y);
    rect.setAttribute('width', w);
    rect.setAttribute('height', h);
    rect.setAttribute('rx', 18);
    rect.setAttribute('class','shape');
    svg.appendChild(rect);

    var lenLine = addLine(svg, x, y+h+22, x+w, y+h+22, 'line');
    lenLine.setAttribute('marker-start','url(#arrow)');
    lenLine.setAttribute('marker-end','url(#arrow)');
    addText(svg, x+w/2-52, y+h+50, isSquare ? ('è¾¹é•¿ ' + L + ' cm') : ('é•¿ ' + L + ' cm'));

    var widLine = addLine(svg, x+w+22, y, x+w+22, y+h, 'line');
    widLine.setAttribute('marker-start','url(#arrow)');
    widLine.setAttribute('marker-end','url(#arrow)');
    addText(svg, x+w+30, y+h/2+6, isSquare ? ('è¾¹é•¿ ' + W + ' cm') : ('å®½ ' + W + ' cm'));

    addText(svg, 20, 42, isSquare ? 'æ­£æ–¹å½¢ï¼ˆå¹³é¢å›¾ï¼‰' : 'é•¿æ–¹å½¢ï¼ˆå¹³é¢å›¾ï¼‰');
  }

  function drawTriangle(svg, b, h){
    var A = {x:120, y:220};
    var B = {x:360, y:220};
    var C = {x:260, y:80};

    var path = document.createElementNS(svg.namespaceURI,'path');
    path.setAttribute('d', 'M ' + A.x + ' ' + A.y + ' L ' + B.x + ' ' + B.y + ' L ' + C.x + ' ' + C.y + ' Z');
    path.setAttribute('class','shape');
    svg.appendChild(path);

    // é«˜ï¼ˆè™šçº¿ï¼‰
    var D = {x: C.x, y: A.y};
    var hl = addLine(svg, C.x, C.y, D.x, D.y, 'line dash');

    // ç›´è§’ç¬¦å·
    var r = 16;
    var right = document.createElementNS(svg.namespaceURI,'path');
    right.setAttribute('d', 'M ' + D.x + ' ' + D.y + ' m 0 -' + r + ' l ' + r + ' 0 l 0 ' + r);
    right.setAttribute('fill','none');
    right.setAttribute('class','line');
    svg.appendChild(right);

    // åº•
    var base = addLine(svg, A.x, A.y+22, B.x, A.y+22, 'line');
    base.setAttribute('marker-start','url(#arrow)');
    base.setAttribute('marker-end','url(#arrow)');
    addText(svg, (A.x+B.x)/2-46, A.y+50, 'åº• ' + b + ' cm');

    // é«˜
    var hh = addLine(svg, D.x+22, C.y, D.x+22, D.y, 'line');
    hh.setAttribute('marker-start','url(#arrow)');
    hh.setAttribute('marker-end','url(#arrow)');
    addText(svg, D.x+34, (C.y+D.y)/2+6, 'é«˜ ' + h + ' cm');

    addText(svg, 20, 42, 'ä¸‰è§’å½¢ï¼ˆåº•ä¸é«˜ï¼‰');
  }

  function drawRegularPolygon(svg, n, s){
    var cx=240, cy=155, R=90;
    var pts = [];
    var start = -Math.PI/2;
    for(var i=0;i<n;i++){
      var ang = start + i*(2*Math.PI/n);
      pts.push([cx + R*Math.cos(ang), cy + R*Math.sin(ang)]);
    }

    var poly = document.createElementNS(svg.namespaceURI,'polygon');
    var pstr = '';
    for(var j=0;j<pts.length;j++){
      if(j) pstr += ' ';
      pstr += pts[j][0].toFixed(1) + ',' + pts[j][1].toFixed(1);
    }
    poly.setAttribute('points', pstr);
    poly.setAttribute('class','shape');
    svg.appendChild(poly);

    addText(svg, 20, 42, 'æ­£' + n + 'è¾¹å½¢');
    addText(svg, 20, 70, 'è¾¹æ•° = ' + n);
    addText(svg, 20, 98, 'è¾¹é•¿ = ' + s + ' cm');

    // é«˜äº®ä¸€æ¡è¾¹
    var p0 = pts[0], p1 = pts[1];
    var hi = addLine(svg, p0[0], p0[1], p1[0], p1[1], 'line');
    hi.setAttribute('stroke','rgba(255,127,176,.9)');
    hi.setAttribute('stroke-width','5');
  }

  function drawCuboid(svg, L, W, H, isCube){
    // èµ·ç‚¹å‘å·¦ä¸€äº›ï¼Œé¿å…å³ä¾§æ–‡å­—è¢«è£åˆ‡
    var fx = 80;
    var fy = 95;

    // æ­£æ–¹ä½“ï¼šå‰é¢å¿…é¡»æ˜¯æ­£æ–¹å½¢
    var fw = isCube ? 130 : 190;
    var fh = isCube ? 130 : 140;

    // æ­£æ–¹ä½“é€è§†åç§»ä¿æŒç­‰è·
    var dx = isCube ? 40 : 60;
    var dy = isCube ? -40 : -40;

    var FBL = {x:fx,      y:fy+fh};
    var FBR = {x:fx+fw,   y:fy+fh};
    var BBR = {x:fx+fw+dx,y:fy+fh+dy};
    var BTR = {x:fx+fw+dx,y:fy+dy};

    var front = 'M ' + fx + ' ' + fy + ' L ' + (fx+fw) + ' ' + fy + ' L ' + (fx+fw) + ' ' + (fy+fh) + ' L ' + fx + ' ' + (fy+fh) + ' Z';
    var top   = 'M ' + fx + ' ' + fy + ' L ' + (fx+dx) + ' ' + (fy+dy) + ' L ' + (fx+fw+dx) + ' ' + (fy+dy) + ' L ' + (fx+fw) + ' ' + fy + ' Z';
    var side  = 'M ' + (fx+fw) + ' ' + fy + ' L ' + (fx+fw+dx) + ' ' + (fy+dy) + ' L ' + (fx+fw+dx) + ' ' + (fy+fh+dy) + ' L ' + (fx+fw) + ' ' + (fy+fh) + ' Z';

    var pTop = document.createElementNS(svg.namespaceURI,'path');
    pTop.setAttribute('d', top);
    pTop.setAttribute('class','soft');
    svg.appendChild(pTop);

    var pSide = document.createElementNS(svg.namespaceURI,'path');
    pSide.setAttribute('d', side);
    pSide.setAttribute('class','soft');
    pSide.setAttribute('fill','rgba(255,127,176,.10)');
    svg.appendChild(pSide);

    var pFront = document.createElementNS(svg.namespaceURI,'path');
    pFront.setAttribute('d', front);
    pFront.setAttribute('class','shape');
    svg.appendChild(pFront);

    addLine(svg, fx, fy, fx+dx, fy+dy, 'line');
    addLine(svg, fx+fw, fy, fx+fw+dx, fy+dy, 'line');
    addLine(svg, fx+fw, fy+fh, fx+fw+dx, fy+fh+dy, 'line');
    addLine(svg, fx+dx, fy+dy, fx+fw+dx, fy+dy, 'line');
    addLine(svg, fx+fw+dx, fy+dy, fx+fw+dx, fy+fh+dy, 'line');

    addText(svg, 20, 42, isCube ? 'æ­£æ–¹ä½“ï¼ˆç«‹ä½“å›¾ï¼‰' : 'é•¿æ–¹ä½“ï¼ˆç«‹ä½“å›¾ï¼‰');

    // é•¿ï¼šå‰åº•è¾¹
    var lenLine = addLine(svg, FBL.x, FBL.y+22, FBR.x, FBR.y+22, 'line');
    lenLine.setAttribute('marker-start','url(#arrow)');
    lenLine.setAttribute('marker-end','url(#arrow)');
    addText(svg, (FBL.x+FBR.x)/2-48, FBL.y+50, isCube ? ('è¾¹é•¿ ' + L + ' cm') : ('é•¿ ' + L + ' cm'));

    // å®½ï¼šå³ä¸‹æ–œè¾¹ï¼ˆæ–‡å­—åç§»ï¼Œé¿å…é®æŒ¡ç®­å¤´ï¼‰
    var vx = (BBR.x - FBR.x), vy = (BBR.y - FBR.y);
    var vlen = Math.sqrt(vx*vx + vy*vy) || 1;
    var nx = (-vy)/vlen, ny = (vx)/vlen;
    var off = 18;
    var wx1 = FBR.x + nx*off, wy1 = FBR.y + ny*off;
    var wx2 = BBR.x + nx*off, wy2 = BBR.y + ny*off;
    var widLine = addLine(svg, wx1, wy1, wx2, wy2, 'line');
    widLine.setAttribute('marker-start','url(#arrow)');
    widLine.setAttribute('marker-end','url(#arrow)');
    addText(svg,
      (wx1+wx2)/2 + nx*38 + 10,
      (wy1+wy2)/2 + ny*38 + 10,
      isCube ? ('è¾¹é•¿ ' + W + ' cm') : ('å®½ ' + W + ' cm')
    );

    // é«˜ï¼šå³ä¾§ç«–è¾¹
    var hx = BTR.x + 22, hy1 = BTR.y, hy2 = BBR.y;
    var htLine = addLine(svg, hx, hy1, hx, hy2, 'line');
    htLine.setAttribute('marker-start','url(#arrow)');
    htLine.setAttribute('marker-end','url(#arrow)');
    addText(svg, hx + 22, (hy1+hy2)/2 + 6, isCube ? ('è¾¹é•¿ ' + H + ' cm') : ('é«˜ ' + H + ' cm'));
  }

  // =====================
  // 6) Judge / Feedback
  // =====================
  function setMsg(kind, title, body, eq){
    var msg = getEl('msg');
    if(!msg) return;
    msg.className = 'msg show ' + kind;

    var t = getEl('msgTitle'); if(t) t.textContent = title;
    var b = getEl('msgBody');  if(b) b.textContent = body;
    var e = getEl('msgEq');    if(e) e.textContent = eq || '';

    var svg = getEl('msgSvg');
    if(!svg) return;
    svg.innerHTML = '';
    if(kind==='good'){
      svg.innerHTML = '<path d="M20 7L10 17l-4-4" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>';
    }else if(kind==='bad'){
      svg.innerHTML = '<path d="M7 7l10 10M17 7L7 17" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>';
    }else{
      svg.innerHTML = '<path d="M12 8v5" stroke="currentColor" stroke-width="3" stroke-linecap="round"/><path d="M12 17h.01" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>';
    }
  }

  // =====================
  // 7) UI Controller
  // =====================
  var State = {
    mode: 'home',
    levelIndex: 0,
    qIndex: 0,
    qTotal: CONFIG.questionsPerLevel,
    current: null,
    totalStars: 0,
    levelStars: 0,
    answeredLocked: false
  };

  function syncTop(){
    var s = getEl('stars'); if(s) s.textContent = 'â­ ' + State.totalStars;
    var b = getEl('best');  if(b) b.textContent = 'â­ ' + Store.bestStars;
  }

  function renderLevels(){
    var box = getEl('levelList');
    if(!box) return;
    box.innerHTML = '';

    for(var i=0;i<CONFIG.levels.length;i++){
      (function(idx){
        var lv = CONFIG.levels[idx];
        var locked = lv.id > Store.unlocked;

        var btn = document.createElement('button');
        btn.className = 'levelBtn' + (locked ? ' locked' : '');
        btn.type = 'button';
        btn.innerHTML =
          '<div class="left">' +
            '<div class="num">' + lv.id + '</div>' +
            '<div>' +
              '<div class="name">' + lv.name + '</div>' +
              '<div class="desc">' + lv.desc + '</div>' +
            '</div>' +
          '</div>' +
          '<div style="font-weight:900; color:' + (locked ? 'rgba(36,50,74,.55)' : 'rgba(36,50,74,.85)') + '">' +
            (locked ? 'ğŸ”’ æœªè§£é”' : 'âœ… å¯æŒ‘æˆ˜') +
          '</div>';

        btn.addEventListener('click', function(){
          if(locked){ toast('å…ˆé€šå…³å‰ä¸€å…³å“¦ï½'); return; }
          startLevel(idx);
        });

        box.appendChild(btn);
      })(i);
    }
  }

  function startLevel(levelIndex){
    State.mode = 'play';
    State.levelIndex = levelIndex;
    State.qIndex = 0;
    State.qTotal = CONFIG.questionsPerLevel;
    State.levelStars = 0;
    State.totalStars = 0;
    State.answeredLocked = false;

    var home = getEl('home'); if(home) home.style.display='none';
    var end  = getEl('end');  if(end)  end.style.display='none';
    var game = getEl('game'); if(game) game.style.display='grid';

    syncTop();
    nextQuestion(true);
  }

  function updateHUD(){
    var lv = CONFIG.levels[State.levelIndex];
    var chip = getEl('stageChip'); if(chip) chip.textContent = 'ç¬¬ ' + lv.id + ' å…³ï¼š' + lv.name;
    var qc = getEl('qCount'); if(qc) qc.textContent = (State.qIndex+1) + ' / ' + State.qTotal;
    var prog = getEl('prog'); if(prog) prog.style.width = ((State.qIndex/State.qTotal)*100) + '%';
    var ls = getEl('levelStars'); if(ls) ls.textContent = 'â­ ' + State.levelStars;
  }

  function setInputUnit(u){
    var unit = getEl('unit'); if(unit) unit.textContent = u;
  }

  function lockAfterAnswer(locked){
    State.answeredLocked = locked;
    var submit = getEl('btnSubmit'); if(submit) submit.disabled = locked;
    var skip = getEl('btnSkip'); if(skip) skip.disabled = locked;
    var ans = getEl('ans'); if(ans) ans.disabled = locked;
  }

  function clearMsg(){
    var msg = getEl('msg'); if(msg) msg.className = 'msg';
    var eq = getEl('msgEq'); if(eq) eq.textContent = '';
  }

  function nextQuestion(isFirst){
    clearMsg();
    lockAfterAnswer(false);

    var ansEl = getEl('ans');
    if(ansEl){ ansEl.value = ''; ansEl.focus(); }

    var lv = CONFIG.levels[State.levelIndex];
    State.current = genQuestion(lv);

    var qt = getEl('qText'); if(qt) qt.textContent = State.current.askText;
    var qh = getEl('qHint'); if(qh) qh.textContent = 'çœ‹å›¾æ‰¾å·²çŸ¥é‡ï¼Œç„¶åé€‰æ‹©åˆé€‚çš„å…¬å¼ã€‚';
    setInputUnit(State.current.unit);

    renderQuestion(State.current);
    updateHUD();

    if(!isFirst){
      var prog = getEl('prog');
      if(prog) prog.style.width = ((State.qIndex/State.qTotal)*100) + '%';
    }
  }

  function finishLevel(){
    State.mode = 'end';

    var game = getEl('game'); if(game) game.style.display='none';
    var end  = getEl('end');  if(end)  end.style.display='block';

    var prog = getEl('prog'); if(prog) prog.style.width = '100%';

    if(State.totalStars > Store.bestStars){
      Store.bestStars = State.totalStars;
      toast('æ–°çºªå½•ï¼');
    }

    var lv = CONFIG.levels[State.levelIndex];
    var passed = State.levelStars >= CONFIG.scoring.unlockStarThreshold;
    if(passed){
      Store.unlocked = Math.max(Store.unlocked, lv.id + 1);
    }

    saveStore();
    syncTop();
    renderLevels();

    var nextId = lv.id + 1;
    var hasNext = nextId <= CONFIG.levels.length;
    var cont = getEl('btnContinue');
    if(cont) cont.style.display = hasNext ? 'inline-block' : 'none';

    var endText = getEl('endText');
    if(endText){
      endText.textContent = 'æœ¬å…³è·å¾— â­ ' + State.levelStars + 'ï¼Œæœ¬å±€ç´¯è®¡ â­ ' + State.totalStars + 'ã€‚';
    }
  }

  function showCorrect(eq){
    lockAfterAnswer(true);
    var gain = CONFIG.scoring.correct;
    State.levelStars += gain;
    State.totalStars += gain;
    syncTop();
    updateHUD();
    setMsg('good','åšå¾—å¥½ï¼', 'ç­”å¯¹å•¦ï¼è·å¾— â­ +' + gain, eq);
  }

  function submit(){
    if(State.answeredLocked) return;

    var input = getEl('ans');
    var raw = input ? String(input.value).trim() : '';
    if(!raw){ toast('å…ˆè¾“å…¥ç­”æ¡ˆï½'); return; }

    var val = Number(raw);
    if(!isFinite(val)){ toast('è¯·è¾“å…¥æ•°å­—ï½'); return; }

    var q = State.current;
    if(!q){ toast('é¢˜ç›®åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•'); return; }

    if(val === q.answer){
      showCorrect(q.steps && q.steps.equation ? q.steps.equation : '');
    }else{
      setMsg('bad','å†æƒ³æƒ³ï½', 'å†æ£€æŸ¥ä¸€ä¸‹é¢˜ç›®å’Œå›¾å½¢æ ‡æ³¨å§ï½', '');
      lockAfterAnswer(false);
    }
  }

  function skip(){
    if(State.answeredLocked) return;

    var p = CONFIG.scoring.skipPenalty;
    State.levelStars = Math.max(0, State.levelStars - p);
    State.totalStars = Math.max(0, State.totalStars - p);
    syncTop();
    updateHUD();

    var q = State.current;
    var eq = (q && q.steps && q.steps.equation) ? q.steps.equation : '';
    setMsg('warn','è·³è¿‡å•¦ï½', 'æ‰£ â­ -' + p + 'ã€‚ç­”æ¡ˆæ˜¯ ' + (q ? q.answer : 'â€”') + 'ã€‚', eq);
    lockAfterAnswer(true);
  }

  function next(){
    if(!State.answeredLocked){
      toast('å…ˆæäº¤æˆ–è·³è¿‡ï¼Œå†ä¸‹ä¸€é¢˜ï½');
      return;
    }

    State.qIndex++;
    if(State.qIndex >= State.qTotal){
      finishLevel();
      return;
    }

    nextQuestion(false);
  }

  function backHome(){
    State.mode='home';

    var game = getEl('game'); if(game) game.style.display='none';
    var end  = getEl('end');  if(end)  end.style.display='none';
    var home = getEl('home'); if(home) home.style.display='block';

    syncTop();
    renderLevels();
  }

  // =====================
  // 8) Self-testsï¼ˆconsoleï¼‰
  // =====================
  function runSelfTests(){
    // 1) ä¸‰è§’å½¢é¢ç§¯å¿…é¡»ä¸ºæ•´æ•°
    for(var i=0;i<200;i++){
      var q = genQuestion({types:['area_triangle']});
      if(q.answer !== Math.floor(q.answer)){
        console.error('TEST FAIL: triangle area not integer', q);
        return;
      }
    }

    // 2) æ­£å¤šè¾¹å½¢å‘¨é•¿æ­£ç¡®
    for(var j=0;j<80;j++){
      var p = genQuestion({types:['perimeter_regular_polygon']});
      if(p.answer !== p.known.n * p.known.s){
        console.error('TEST FAIL: polygon perimeter mismatch', p);
        return;
      }
      if(String(p.steps.equation).indexOf('<') !== -1){
        console.error('TEST FAIL: equation contains HTML', p);
        return;
      }
    }

    // 3) bind() å¿…é¡»æ˜¯å‡½æ•°ï¼ˆé¿å…è¯­æ³•é”™è¯¯å¯¼è‡´æœªå®šä¹‰ï¼‰
    if(typeof bind !== 'function'){
      console.error('TEST FAIL: bind is not a function');
      return;
    }

    // 4) å…³é”® DOM å…ƒç´ å¿…é¡»å­˜åœ¨
    var must = ['btnSubmit','btnSkip','btnNext','btnBack','btnHome','btnContinue','btnCheat','ans','viz','stars','best','levelList'];
    for(var k=0;k<must.length;k++){
      if(!getEl(must[k])){
        console.error('TEST FAIL: missing element #' + must[k]);
        return;
      }
    }

    // 5) æ¸²æŸ“ä¸€æ¬¡ç«‹ä½“å›¾ä¸åº”æŠ›é”™
    try{
      renderQuestion({type:'volume_cube', known:{a:7}, unit:'cmÂ³'});
    }catch(e){
      console.error('TEST FAIL: renderQuestion threw', e);
      return;
    }

    console.log('Self-tests passed âœ…');
  }

  // =====================
  // 9) äº‹ä»¶ç»‘å®š
  // =====================
  function bind(){
    var btnSubmit = getEl('btnSubmit');
    if(btnSubmit){
      btnSubmit.addEventListener('click', function(e){
        var r = e.currentTarget.getBoundingClientRect();
        spawnSparkles(r.left + r.width/2, r.top + r.height/2);
        submit();
      });
    }

    var btnSkip = getEl('btnSkip'); if(btnSkip) btnSkip.addEventListener('click', skip);
    var btnNext = getEl('btnNext'); if(btnNext) btnNext.addEventListener('click', next);
    var btnBack = getEl('btnBack'); if(btnBack) btnBack.addEventListener('click', backHome);
    var btnHome = getEl('btnHome'); if(btnHome) btnHome.addEventListener('click', backHome);

    var btnContinue = getEl('btnContinue');
    if(btnContinue){
      btnContinue.addEventListener('click', function(){
        var nextLevel = clamp(State.levelIndex+1, 0, CONFIG.levels.length-1);
        startLevel(nextLevel);
      });
    }

    var btnCheat = getEl('btnCheat');
    if(btnCheat){
      btnCheat.addEventListener('click', function(){
        var c = getEl('cheat');
        if(!c) return;
        c.style.display = (c.style.display==='none' || !c.style.display) ? 'block' : 'none';
      });
    }

    var ans = getEl('ans');
    if(ans){
      ans.addEventListener('keydown', function(e){
        if(e.key === 'Enter') submit();
      });
    }
  }

  function init(){
    syncTop();
    renderLevels();
    bind();
    runSelfTests();
  }

  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', init);
  }else{
    init();
  }
  </script>
</body>
</html>
